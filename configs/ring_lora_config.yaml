# LTXV LoRA Training Configuration for Ring Project

# Model configuration
model:
  model_source: "LTXV_2B_0.9.6_DEV"
  training_mode: "lora"
  load_checkpoint: null

# LoRA configuration (quantum enhanced)
lora:
  rank: 128
  alpha: 256                       # Enhanced alpha for better adaptation
  dropout: 0.1
  target_modules:
    - "to_k"
    - "to_q"
    - "to_v"
    - "to_out.0"

# Conditioning configuration - Ring FM with Quantum enhancements
conditioning:
  mode: "ring_fm"           # Keep as ring_fm (quantum will be enabled in training strategy)
  first_frame_conditioning_p: 0.1
  t_star: 0.2

# AFM training configuration (quantum enhanced)
afm_training:
  use_phase_separation: false

# Flow Matching configuration
flow_matching:
  timestep_sampling_mode: "uniform"

# Optimization configuration
optimization:
  learning_rate: 5e-5
  steps: 10000
  batch_size: 1
  gradient_accumulation_steps: 1
  max_grad_norm: 0.5  # 강화된 gradient clipping으로 loss spike 방지
  optimizer_type: "adamw8bit" # Options: "adamw" or "adamw8bit"
  scheduler_type: "cosine" # Options: "constant", "linear", "cosine", "cosine_with_restarts", "polynomial"
  scheduler_params: {}
  enable_gradient_checkpointing: true


acceleration:
  mixed_precision_mode: "bf16" # Options: "no", "fp16", "bf16"
  quantization: null # Options: null, "int8-quanto", "int4-quanto", "int2-quanto", "fp8-quanto", "fp8uz-quanto"
  load_text_encoder_in_8bit: false # Load text encoder in 8-bit precision to save memory
  compile_with_inductor: false
  compilation_mode: "reduce-overhead" # Options: "default", "reduce-overhead", "max-autotune"


# Data configuration
data:
  preprocessed_data_root: "/home/dongwoo38/openvid_data" # 실제 경로로 수정
  num_dataloader_workers: 2

# Validation configuration
validation:
  skip_initial_validation: false   # 신호 복구 테스트를 위해 초기 validation 건너뛰기
  prompts:
    -  "The video features a man in a suit and tie, sitting in an office setting. The man is speaking, and his expression is serious. The office has a window with blinds, and the lighting is soft and natural. The man's suit is dark, and his tie is patterned. The office appears to be well-lit, with a warm tone to the lighting. The man's posture is upright, and he is looking directly at the camera. The overall style of the video is professional and formal."
  video_dims:  [512, 512, 25] # VRAM 안전권 해상도
  interval: 1000
  inference_steps: 50
  guidance_scale: 3.5

output_dir: "outputs/quantum_collapse_v1"
seed: 42
wandb:
  enabled: true